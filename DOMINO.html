<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DOMINO HEKA ULTRA</title>

<link href="https://fonts.googleapis.com/css2?family=Righteous&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{
--bg:#0f172a;
--glass:rgba(30,41,59,.95);
--gold:#fbbf24;
--blue:#3b82f6;
}

body{
margin:0;
height:100vh;
font-family:'Cairo';
background:var(--bg);
color:#e5e7eb;
overflow:hidden;
display:flex;
flex-direction:column;
}

.hidden{display:none!important}

h1{
font-family:'Righteous';
text-align:center;
color:var(--gold);
margin:10px 0;
}

.screen{
background:var(--glass);
border-radius:20px;
padding:20px;
width:90%;
max-width:400px;
margin:auto;
text-align:center;
}

button{
background:var(--blue);
border:none;
padding:10px 20px;
color:white;
border-radius:10px;
cursor:pointer;
font-family:'Cairo';
}

input{
padding:10px;
border-radius:8px;
border:1px solid #555;
background:#111;
color:white;
width:80%;
text-align:center;
}

/* ===== GAME ===== */
#screen-game{width:100%;height:100%}

#table{
flex:1;
margin:10px;
border-radius:20px;
background:#020617;
position:relative;
overflow:hidden;
}

#board{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
}

.domino{
width:60px;
height:30px;
background:#f1f2f6;
border-radius:4px;
display:flex;
border:1px solid #999;
position:absolute;
}

.domino.double{
transform:rotate(90deg);
}

.pip-box{
width:30px;
display:grid;
grid-template-columns:repeat(3,1fr);
grid-template-rows:repeat(3,1fr);
padding:3px;
}

.pip{
width:6px;
height:6px;
background:#111;
border-radius:50%;
margin:auto;
}

.line{
width:2px;
background:#ccc;
}

/* ===== HAND ===== */
#my-area{
height:140px;
background:black;
display:flex;
align-items:flex-end;
justify-content:center;
padding-bottom:20px;
border-top:2px solid #333;
z-index:999;
}

#my-hand{
display:flex;
overflow-x:auto;
padding:10px;
}

.hand{
width:36px;
height:72px;
margin:0 5px;
flex-direction:column;
cursor:pointer;
}

.hand.selected{
transform:translateY(-25px) scale(1.1);
box-shadow:0 0 15px var(--gold);
}

/* ===== PIPS ===== */
.p1{grid-area:2/2}
.p2-1{grid-area:1/3}.p2-2{grid-area:3/1}
.p3-1{grid-area:1/3}.p3-2{grid-area:2/2}.p3-3{grid-area:3/1}
.p4-1{grid-area:1/1}.p4-2{grid-area:1/3}.p4-3{grid-area:3/1}.p4-4{grid-area:3/3}
.p5-1{grid-area:1/1}.p5-2{grid-area:1/3}.p5-3{grid-area:2/2}.p5-4{grid-area:3/1}.p5-5{grid-area:3/3}
.p6-1{grid-area:1/1}.p6-2{grid-area:1/3}.p6-3{grid-area:2/1}.p6-4{grid-area:2/3}.p6-5{grid-area:3/1}.p6-6{grid-area:3/3}
</style>
</head>

<body>

<h1>HEKA ULTRA</h1>

<div id="screen-login" class="screen">
<h3>اسمك</h3>
<input id="name">
<br><br>
<button onclick="login()">دخول</button>
</div>

<div id="screen-game" class="hidden">
<div id="table">
<div id="board"></div>
</div>

<div id="my-area">
<div id="my-hand"></div>
</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyCp9_P3K__Sr76iKgaVG1iD4NluUqPtni4",
authDomain:"heka-codenames.firebaseapp.com",
databaseURL:"https://heka-codenames-default-rtdb.firebaseio.com",
projectId:"heka-codenames"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let myName="",myId="",game=null,selected=-1;

function login(){
myName=document.getElementById("name").value.trim();
if(!myName)return;
myId=Date.now().toString();
startGame();
document.getElementById("screen-login").classList.add("hidden");
document.getElementById("screen-game").classList.remove("hidden");
}

/* ===== START WITH BIGGEST DOUBLE ===== */
function startGame(){
let tiles=[];
for(let i=0;i<=6;i++)for(let j=i;j<=6;j++)tiles.push({a:i,b:j});
tiles.sort(()=>Math.random()-0.5);

let hand=tiles.splice(0,7);
game={board:[],hand};

renderHand();
}

/* ===== REAL SNAKE LAYOUT ===== */
const W=60,H=30,G=8,LIMIT=7;

function positions(board){
let arr=[],x=0,y=0,dir=1,count=0;
board.forEach(t=>{
arr.push({x,y,dir});
count++;
if(count>=LIMIT){
y+=H+20;
dir*=-1;
count=0;
}else x+=(W+G)*dir;
});
let minX=Math.min(...arr.map(p=>p.x));
let maxX=Math.max(...arr.map(p=>p.x));
let minY=Math.min(...arr.map(p=>p.y));
let maxY=Math.max(...arr.map(p=>p.y));
arr.forEach(p=>{
p.x-=(minX+maxX)/2;
p.y-=(minY+maxY)/2;
});
return arr;
}

function renderBoard(){
const b=document.getElementById("board");
b.innerHTML="";
const pos=positions(game.board);
let connect=null;

game.board.forEach((t,i)=>{
let a=t.a,bv=t.b;
if(i>0){
if(a!==connect)[a,bv]=[bv,a];
}
connect=bv;
b.innerHTML+=`
<div class="domino ${a===bv?'double':''}"
style="left:${pos[i].x}px;top:${pos[i].y}px">
<div class="pip-box">${pips(a)}</div>
<div class="line"></div>
<div class="pip-box">${pips(bv)}</div>
</div>`;
});
}

function renderHand(){
const h=document.getElementById("my-hand");
h.innerHTML="";
game.hand.forEach((t,i)=>{
h.innerHTML+=`
<div class="domino hand ${selected===i?'selected':''}" onclick="play(${i})">
<div class="pip-box">${pips(t.a)}</div>
<div class="line"></div>
<div class="pip-box">${pips(t.b)}</div>
</div>`;
});
}

function play(i){
const t=game.hand[i];
game.board.push(t);
game.hand.splice(i,1);
selected=-1;
renderBoard();
renderHand();
}

function pips(n){
const m={
0:[],1:['p1'],2:['p2-1','p2-2'],3:['p3-1','p3-2','p3-3'],
4:['p4-1','p4-2','p4-3','p4-4'],
5:['p5-1','p5-2','p5-3','p5-4','p5-5'],
6:['p6-1','p6-2','p6-3','p6-4','p6-5','p6-6']
};
return m[n].map(c=>`<div class="pip ${c}"></div>`).join("");
}
</script>

</body>
</html>
