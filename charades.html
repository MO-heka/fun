<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ­ ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Tajawal:wght@500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style>
        :root {
            --bg-color: #0f172a;
            --card-color: #1e293b;
            --primary-color: #8b5cf6;
            /* Violet */
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Cairo', 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
            text-align: center;
        }

        h1,
        h2,
        h3 {
            margin: 10px 0;
            color: var(--text-main);
        }

        h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            font-weight: 900;
        }

        .btn {
            width: 100%;
            padding: 18px;
            margin: 10px 0;
            border: none;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: 800;
            font-family: 'Tajawal', sans-serif;
            cursor: pointer;
            transition: 0.2s;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-violet {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .btn-green {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #334155;
            color: var(--text-muted);
        }

        .game-input {
            width: 100%;
            padding: 15px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 12px;
            color: white;
            font-size: 1.2rem;
            text-align: center;
            margin: 15px 0;
        }

        /* Gameplay Elements */
        .timer-big {
            font-size: 4rem;
            font-weight: 900;
            color: var(--accent-color);
            margin: 10px 0;
            text-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        .timer-warning {
            color: #ef4444;
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .player-img-container {
            width: 200px;
            height: 200px;
            margin: 10px auto;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid var(--primary-color);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
            background: #000;
        }

        .player-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            text-align: right;
            border-right: 4px solid var(--primary-color);
        }

        .scoreboard {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .score-card {
            flex: 1;
            background: var(--card-color);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid transparent;
            text-align: center;
        }

        .score-card.active {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.1);
        }

        .score-val {
            font-size: 2rem;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div class="container">

        <!-- Menu -->
        <div id="screen-menu" class="screen active card animate__animated animate__fadeIn">
            <h1 style="font-size: 4rem;">ğŸ­âš½</h1>
            <h1>ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨</h1>
            <p style="color:var(--text-muted); font-size:1.1rem;">Ù„Ø¹Ø¨Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© (Offline)</p>
            <p style="margin-bottom: 30px; font-size:0.9rem;">
                ÙƒÙ„ ÙØ±ÙŠÙ‚ ÙŠØ®ØªØ§Ø± Ù…Ù…Ø«Ù„.<br>
                Ø§Ù„Ù…Ù…Ø«Ù„ Ù…Ø¹Ø§Ù‡ 70 Ø«Ø§Ù†ÙŠØ© ÙŠÙ…Ø«Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„ØµØ¯ÙŠÙ‚Ù‡ Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ø§Ù….<br>
                Ù„Ùˆ Ù…Ø¹Ø±ÙØ´ØŒ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ§Ù†ÙŠ ÙŠØ®Ø·Ù Ø§Ù„Ù†Ù‚Ø·Ø© ÙÙŠ 10 Ø«ÙˆØ§Ù†ÙŠ!
            </p>

            <button class="btn btn-violet" onclick="showScreen('screen-setup')">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
            <button class="btn btn-secondary" onclick="window.location.href='index.html'">Ø®Ø±ÙˆØ¬</button>
        </div>

        <!-- Setup -->
        <div id="screen-setup" class="screen card">
            <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±Ù‚</h2>

            <label style="display:block; text-align:right;">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</label>
            <input type="text" id="t1-name" class="game-input" value="Ø§Ù„ÙØ±ÙŠÙ‚ 1">

            <label style="display:block; text-align:right;">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
            <input type="text" id="t2-name" class="game-input" value="Ø§Ù„ÙØ±ÙŠÙ‚ 2">

            <label style="display:block; text-align:right;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</label>
            <input type="number" id="rounds-num" class="game-input" value="5" min="1" max="20">

            <button class="btn btn-violet" onclick="startGame()">âœ… ØªÙ…</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-menu')">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <!-- Ready -->
        <div id="screen-ready" class="screen card">
            <h2>Ø¯ÙˆØ±: <span id="ready-team-name" style="color:var(--primary-color)">...</span></h2>
            <div style="margin: 40px 0;">
                <p style="font-size:1.5rem;">ğŸ­ Ø§Ù„Ù…Ù…Ø«Ù„ ÙŠÙ…Ø³Ùƒ Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†</p>
                <p style="color:var(--text-muted);">Ø§Ù„Ø´Ø§Ø´Ø© ÙÙŠÙ‡Ø§ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ù‡ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.</p>
                <p style="color:var(--danger-color); font-weight:bold;">Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù…Ù…Ø«Ù„ ÙŠØªÙƒÙ„Ù… Ø£Ùˆ ÙŠÙ‚ÙˆÙ„ Ø§Ù„Ø§Ø³Ù…!</p>
            </div>
            <button class="btn btn-green" onclick="startTurn()">ğŸ”¥ Ø§Ø¨Ø¯Ø£ (70 Ø«Ø§Ù†ÙŠØ©)</button>
        </div>

        <!-- Acting Phase -->
        <div id="screen-acting" class="screen">
            <!-- Score Bar -->
            <div class="scoreboard">
                <div id="sc-t1" class="score-card">
                    <div id="l-t1">Ø§Ù„ÙØ±ÙŠÙ‚ 1</div>
                    <div class="score-val" id="s-t1">0</div>
                </div>
                <div id="sc-t2" class="score-card">
                    <div id="l-t2">Ø§Ù„ÙØ±ÙŠÙ‚ 2</div>
                    <div class="score-val" id="s-t2">0</div>
                </div>
            </div>

            <div class="card">
                <div id="timer-display" class="timer-big">70</div>

                <div class="player-img-container">
                    <img id="p-img" src="" class="player-img"
                        onerror="this.src='https://via.placeholder.com/200?text=No+Image'">
                </div>

                <h2 id="p-name" style="font-size:2rem; margin-bottom:5px;">...</h2>

                <div class="info-box">
                    <strong>ğŸŒ Ø§Ù„Ø¬Ù†Ø³ÙŠØ©:</strong> <span id="p-nat">...</span><br>
                    <strong>ğŸ‘• Ø£Ù†Ø¯ÙŠØ©/Ù…Ø¹Ù„ÙˆÙ…Ø§Øª:</strong> <span id="p-clubs">...</span>
                </div>

                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button class="btn btn-green" onclick="handleSuccess()">âœ… Ø¹Ø±ÙÙˆÙ‡!</button>
                    <button class="btn btn-red" onclick="forceTimeUp()">âŒ Ù…Ø´ Ø¹Ø§Ø±ÙÙŠÙ†</button>
                </div>
            </div>
        </div>

        <!-- Steal Phase -->
        <div id="screen-steal" class="screen card" style="border-color:var(--danger-color);">
            <h1 style="color:var(--danger-color)">ğŸš¨ ÙØ±ØµØ© Ø®Ø·Ù!</h1>
            <p style="font-size:1.2rem;">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ§Ù†ÙŠ (<span id="steal-team">...</span>) Ù…Ø¹Ø§Ù‡ 10 Ø«ÙˆØ§Ù†ÙŠ ÙŠØ®Ù…Ù†</p>

            <div id="steal-timer" class="timer-big" style="color:var(--danger-color)">10</div>

            <button class="btn btn-green" onclick="handleSteal(true)">âœ… Ø¹Ø±ÙÙˆÙ‡ (Ù†Ù‚Ø·Ø© Ù„Ù‡Ù…)</button>
            <button class="btn btn-secondary" onclick="handleSteal(false)">âŒ Ù…Ø¹Ø±ÙÙˆØ´</button>
        </div>

        <!-- Game Over -->
        <div id="screen-over" class="screen card">
            <h1>ğŸ† Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h1>

            <div style="font-size:1.5rem; margin:20px 0;">
                <p><span id="end-t1">...</span>: <span id="end-s1" style="color:var(--accent-color)">0</span></p>
                <p><span id="end-t2">...</span>: <span id="end-s2" style="color:var(--accent-color)">0</span></p>
            </div>

            <h2 id="winner-msg" class="animate__animated animate__bounceIn"></h2>

            <button class="btn btn-violet" onclick="showScreen('screen-setup')">ğŸ”„ Ø§Ù„Ø¹Ø¨ ØªØ§Ù†ÙŠ</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-menu')">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>

    </div>

    <!-- Load Data -->
    <script src="games_data.js"></script>

    <script>
        // Sound EFX
        const playSound = (type) => {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            const now = ctx.currentTime;

            if (type === 'tick') {
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'end') {
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.linearRampToValueAtTime(200, now + 0.5);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.linearRampToValueAtTime(800, now + 0.2);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            }
        };

        // State
        let game = {
            t1: "F1",
            t2: "F2",
            s1: 0,
            s2: 0,
            rounds: 5,
            currentRound: 0,
            turn: 1, // 1 or 2
            data: [],
            currentCard: null,
            timer: null,
            timeLeft: 0
        };

        window.showScreen = (id) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        };

        window.startGame = () => {
            game.t1 = document.getElementById('t1-name').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 1";
            game.t2 = document.getElementById('t2-name').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 2";
            game.rounds = parseInt(document.getElementById('rounds-num').value) || 5;
            game.s1 = 0;
            game.s2 = 0;
            game.currentRound = 1;
            game.turn = 1; // Team 1 starts

            // Load & Shuffle Data
            if (window.playersData && window.playersData.length > 0) {
                game.data = [...window.playersData].sort(() => 0.5 - Math.random());
            } else {
                alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©! ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ù games_data.js");
                return;
            }

            updateScoreUI();
            setupNextTurn();
        };

        function updateScoreUI() {
            document.getElementById('l-t1').innerText = game.t1;
            document.getElementById('l-t2').innerText = game.t2;
            document.getElementById('s-t1').innerText = game.s1;
            document.getElementById('s-t2').innerText = game.s2;

            document.getElementById('sc-t1').classList.toggle('active', game.turn === 1);
            document.getElementById('sc-t2').classList.toggle('active', game.turn === 2);
        }

        function setupNextTurn() {
            // Check Game Over
            if (game.currentRound > game.rounds) {
                endGame();
                return;
            }

            // Pick Card
            if (game.data.length === 0) {
                // Reshuffle if ran out
                game.data = [...window.playersData].sort(() => 0.5 - Math.random());
            }
            game.currentCard = game.data.pop();

            // Set Ready Screen
            const teamName = game.turn === 1 ? game.t1 : game.t2;
            document.getElementById('ready-team-name').innerText = teamName;

            showScreen('screen-ready');
        }

        window.startTurn = () => {
            // Setup Card UI
            document.getElementById('p-name').innerText = game.currentCard.name;
            document.getElementById('p-nat').innerText = game.currentCard.nat;
            document.getElementById('p-clubs').innerText = game.currentCard.clubs;
            document.getElementById('p-img').src = game.currentCard.img;

            // Timer
            game.timeLeft = 70;
            updateTimerDisplay();
            showScreen('screen-acting');

            if (game.timer) clearInterval(game.timer);
            game.timer = setInterval(() => {
                game.timeLeft--;
                updateTimerDisplay();
                if (game.timeLeft <= 10) playSound('tick');

                if (game.timeLeft <= 0) {
                    clearInterval(game.timer);
                    playSound('end');
                    // Time Up -> Go to Steal Phase
                    startStealPhase();
                }
            }, 1000);
        };

        function updateTimerDisplay() {
            const el = document.getElementById('timer-display');
            el.innerText = game.timeLeft;
            if (game.timeLeft <= 10) el.classList.add('timer-warning');
            else el.classList.remove('timer-warning');
        }

        window.handleSuccess = () => {
            if (game.timer) clearInterval(game.timer);
            playSound('win');

            // Add point
            if (game.turn === 1) game.s1++;
            else game.s2++;

            updateScoreUI();
            finishTurn();
        };

        window.forceTimeUp = () => {
            if (game.timer) clearInterval(game.timer);
            startStealPhase();
        };

        function startStealPhase() {
            const stealingTeam = game.turn === 1 ? game.t2 : game.t1;
            document.getElementById('steal-team').innerText = stealingTeam;

            game.timeLeft = 10;
            document.getElementById('steal-timer').innerText = 10;
            showScreen('screen-steal');

            game.timer = setInterval(() => {
                game.timeLeft--;
                document.getElementById('steal-timer').innerText = game.timeLeft;
                if (game.timeLeft <= 3) playSound('tick');

                if (game.timeLeft <= 0) {
                    clearInterval(game.timer);
                    playSound('end');
                    handleSteal(false); // Auto fail steal
                }
            }, 1000);
        }

        window.handleSteal = (success) => {
            if (game.timer) clearInterval(game.timer);

            if (success) {
                playSound('win');
                // Point to *other* team
                if (game.turn === 1) game.s2++; // Team 2 stole
                else game.s1++; // Team 1 stole
            }

            updateScoreUI();
            finishTurn();
        };

        function finishTurn() {
            // Switch Turn
            if (game.turn === 1) {
                game.turn = 2;
                // Same Round
            } else {
                game.turn = 1;
                game.currentRound++;
            }

            setupNextTurn();
        }

        function endGame() {
            document.getElementById('end-t1').innerText = game.t1;
            document.getElementById('end-t2').innerText = game.t2;
            document.getElementById('end-s1').innerText = game.s1;
            document.getElementById('end-s2').innerText = game.s2;

            let msg = "";
            if (game.s1 > game.s2) msg = `ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: ${game.t1}`;
            else if (game.s2 > game.s1) msg = `ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: ${game.t2}`;
            else msg = "ğŸ¤ ØªØ¹Ø§Ø¯Ù„!";

            document.getElementById('winner-msg').innerText = msg;
            showScreen('screen-over');
        }

    </script>
</body>

</html>